proxy_cache_path                    /var/cache/nginx levels=1:2 keys_zone=products_cache:100m inactive=60m;

server {
    listen                          80;

    location /products/ {
        proxy_pass                  http://127.0.0.1/products/;
        proxy_cache                 products_cache;
        proxy_cache_valid           any 10m;
        add_header                  X-Proxy-Cache $upstream_cache_status;
    }

    location ~ ^/products/([0-9]+)$ {
        proxy_pass                  http://127.0.0.1/products/$1;
    }
}